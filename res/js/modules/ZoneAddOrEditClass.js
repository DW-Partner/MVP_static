!function(t){function e(i){if(o[i])return o[i].exports;var a=o[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var o={};e.m=t,e.c=o,e.d=function(t,o,i){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/",e(e.s=266)}({181:function(t,e,o){"use strict";$.fn.DDSort=function(t){var e={down:$.noop,move:$.noop,up:$.noop,target:"li",delay:100,cloneStyle:{"background-color":"#fff"},floatStyle:{position:"fixed","background-color":"#FEFEF2","box-shadow":"10px 10px 20px 0 #eee"}},o=$(document),i=$.extend(!0,{},e,t);return this.each(function(){var t=$(this),e="height",a="width";"border-box"==t.css("box-sizing")&&(e="outerHeight",a="outerWidth"),t.on("mousedown.DDSort touchstart.DDSort",i.target,function(n){var s=(new Date).getTime();if("mousedown"!=n.type||1==n.which){var l=n.target.tagName.toLowerCase();if("input"!=l&&"textarea"!=l&&"select"!=l&&"a"!=l&&"true"!=$(n.target).prop("contenteditable")){var r=this,c=$(r),u=c.offset(),p=n.pageX,d=n.pageY,m=n.originalEvent.targetTouches;"touchstart"==n.type&&m&&(p=m[0].pageX,d=m[0].pageY);var h=p-u.left,v=d-u.top,f=c.clone().css(i.cloneStyle).css("height",c[e]()).empty(),_=1,g=c.outerHeight(),y=t.outerHeight(),b=g,k=g,x=3*g;return i.down.call(r),o.on("mousemove.DDSort touchmove.DDSort",function(e){var n=e.pageX,l=e.pageY,u=e.originalEvent.targetTouches;if("touchmove"==e.type&&u&&(n=u[0].pageX,l=u[0].pageY),!((new Date).getTime()-s<i.delay)){_&&(c.before(f).css("width",c[a]()).css(i.floatStyle).appendTo(c.parent()),_=0);var p=n-h,d=l-v,m=f.prev(),$=f.next().not(c);c.css({left:p-o.scrollLeft(),top:d-o.scrollTop()}),m.length&&d<m.offset().top+m.outerHeight()/2?f.after(m):$.length&&d+g>$.offset().top+$.outerHeight()/2&&f.before($);var w,T=t.scrollTop(),D=t.offset().top;d<D?(k=g,b=++b>x?x:b,w=T-b):d+g-D>y&&(b=g,k=++k>x?x:k,w=T+k),t.scrollTop(w),i.move.call(r,p-o.scrollLeft(),d-o.scrollTop())}}).on("mouseup.DDSort touchend.DDSort",function(){o.off("mousemove.DDSort mouseup.DDSort touchmove.DDSort touchend.DDSort"),_||(f.before(c.removeAttr("style")).remove(),i.up.call(r))}),!1}}})})}},266:function(t,e,o){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var a=o(7),n=i(a),s=o(181);i(s);o(267);var l=$("#classid").val(),r={edit:'<li>\t\t\t<span class="wide"><i>*</i>班级名称</span>\t\t\t<input type="text" class="short" placeholder="请输入班级名称" value="{class_name}" name="class_name" data-validate="any" data-must="1" />\t\t</li>\t\t<li>\t\t\t<span class="wide"><i>*</i>分类课程</span>\t\t\t<em>{course_name} </em>\t\t\t<em class="tips"></em>\t\t\t<a href="JavaScript:;" class="selected_lessons">重新关联课程</a>\t\t</li>\t\t<li>\t\t\t<span class="wide"><i>*</i>预招人数</span>\t\t\t<input type="text" class="short" placeholder="请输入预招人数" value="{reserve_num}" name="reserve_num" data-validate="number" data-must="1" />\t\t</li>\t\t<li>\t\t\t<span class="wide"><i>*</i>选择教师</span>\t\t\t<select name="teacher_id" data-validate="any" data-must="1">\t\t\t</select>\t\t</li>\t\t<li>\t\t\t<span class="wide">选择助教</span>\t\t\t<select name="assistant_id" data-validate="any">\t\t\t</select>\t\t</li>\t\t<li>\t\t\t<span class="wide"><i>*</i>开班时间</span>\t\t\t<input type="text" value="{start_time}" id="start_time" class="short" name="start_time" data-validate="any" data-must="1"/>\t\t</li>\t\t<li>\t\t\t<span class="wide">教室位置</span>\t\t\t<input type="text" value="{classroom}" id="classroom" class="short" name="classroom" data-validate="any"/>\t\t</li>\t\t<li>\t\t\t<span class="wide" style="width:110px;">设置为试听班级</span>\t\t\t<input type="checkbox" id="set_audit" class="m-checkbox" value="1"><label for="set_audit"></label>\t\t</li>\t\t<li>\t\t<span class="wide"><i>*</i>上课时段</span>\t\t\t<div class="timeList">\t\t\t</div>\t\t</li>',_item:'<div class="item">\t\t\t\t\t<select class="timeType">\t\t\t\t\t\t<option value="day">每日</option>\t\t\t\t\t\t<option value="week">每周</option>\t\t\t\t\t\t<option value="month">每月</option>\t\t\t\t\t</select>\t\t\t\t\t<select class="week none">\t\t\t\t\t\t<option value="2">星期一</option>\t\t\t\t\t\t<option value="3">星期二</option>\t\t\t\t\t\t<option value="4">星期三</option>\t\t\t\t\t\t<option value="5">星期四</option>\t\t\t\t\t\t<option value="6">星期五</option>\t\t\t\t\t\t<option value="7">星期六</option>\t\t\t\t\t\t<option value="1">星期日</option>\t\t\t\t\t</select>\t\t\t\t\t<select class="month none">\t\t\t\t\t\t<option value="1">1日</option><option value="2">2日</option>\t\t\t\t\t\t<option value="3">3日</option><option value="4">4日</option>\t\t\t\t\t\t<option value="5">5日</option><option value="6">6日</option>\t\t\t\t\t\t<option value="7">7日</option><option value="8">8日</option>\t\t\t\t\t\t<option value="9">9日</option><option value="10">10日</option>\t\t\t\t\t\t<option value="11">11日</option><option value="12">12日</option>\t\t\t\t\t\t<option value="13">13日</option><option value="14">14日</option>\t\t\t\t\t\t<option value="15">15日</option><option value="16">16日</option>\t\t\t\t\t\t<option value="17">17日</option><option value="18">18日</option>\t\t\t\t\t\t<option value="19">19日</option><option value="20">20日</option>\t\t\t\t\t\t<option value="21">21日</option><option value="22">22日</option>\t\t\t\t\t\t<option value="23">23日</option><option value="24">24日</option>\t\t\t\t\t\t<option value="25">25日</option><option value="26">26日</option>\t\t\t\t\t\t<option value="27">27日</option><option value="28">28日</option>\t\t\t\t\t\t<option value="29">29日</option><option value="30">30日</option>\t\t\t\t\t\t<option value="31">31日</option>\t\t\t\t\t</select>\t\t\t\t\t<input type="text" class="short" placeholder="请输入上课时段" />\t\t\t\t\t<a href="JavaScript:;" class="btn_dis run_item_del">删除</a>\t\t\t\t</div>'},c='<li>        <div class="item"><p><span>{snum}</span></p></div>        <div class="item"><p><span>{theme}</span></p></div>        <div class="item"><p><span>{status}</span></p></div>        <div class="item"><p><span class="line20px">{outline}</span></p></div>        <div class="item"><p><span>        <input type="checkbox" value="{lesson_id}" {disabled} />        </span></p></div>    </li>',u=void 0,p=void 0,d={},m={},h=[],v="x",f=function(t,e,o){$.ajax({type:"post",dataType:"json",url:"/pss/getCourseDetail",data:{code:$("#zone_code").val(),courseid:t},success:function(t){if(0!=t.errcode)return void $.dialogFull.Tips(t.errmsg);h=t.data.lessons,v=t.data.course_id,d["course_"+v]={},m["course_"+v]&&m["course_"+v].length?$(".selected_lessons").text("挑选课时("+m["course_"+v].length+")"):$(".selected_lessons").text("重新关联课程"),g(e||"",o)},error:function(){$.dialogFull.Tips("网络错误，请稍后重试！")}})},_="",g=function(t,e){e?(_="",h.forEach(function(t,e){d["course_"+v][t.lesson_id]=t,t.disabled="正常"===t.status?'class="input_item"':'disabled="disabled"',_+=(0,n.default)(c,t)}),$(".dialogPopBox .body").html(_),m["course_"+v]&&m["course_"+v].length?(m["course_"+v].forEach(function(t,e){$("[value="+t.lesson_id+"]").attr("checked","true")}),m["course_"+v].length===$(".pub_list .body input.input_item").length?$("#checkall").prop("checked",!0):$("#checkall").prop("checked",!1)):$("#checkall").prop("checked",!1)):(_=t+'<div class="head"><span>课时序号</span><span>课时主题名</span><span>当前状态</span><span>教学大纲</span><span>全选 <input type="checkbox" id="checkall"></span></div><ul class="body">',h.forEach(function(t,e){d["course_"+v][t.lesson_id]=t,t.disabled="正常"===t.status?'class="input_item"':'disabled="disabled"',_+=(0,n.default)(c,t)}),_+="</ul>")};!function(){$.ajax({type:"post",dataType:"json",url:"/pss/getCourseList",data:{code:$("#zone_code").val(),zoneid:$("#zone_zoneid").val()},success:function(t){if(0!=t.errcode)return void $.dialogFull.Tips(t.errmsg);var e='<div class="dialogSelect"><select name="course_id" data-validate="any" data-must="1">',o=void 0;t.data.map(function(t,i){0===i&&(o=t.course_id),e+='<option value="'+t.course_id+'">'+t.course_name+"</option>"}),e+="</select>",e+='<span>\n\t\t\t\t<input type="radio" name="delete_old" value="false" id="delete_old_false" checked="checked" />\n\t\t\t\t<label for="delete_old_false">原有课程剩余课时结束后生效</label>\n\t\t\t</span>\n\t\t\t<span>\n\t\t\t\t<input type="radio" name="delete_old" value="true" id="delete_old_true" />\n\t\t\t\t<label for="delete_old_true">删除原有课程剩余课时</label>\n\t\t\t</span>\n\t\t\t</div>',f(o,e)},error:function(){$.dialogFull.Tips("网络错误，请稍后重试！")}})}();var y=function(){$("#checkall").prop("checked")?$(".pub_list .body input.input_item").prop("checked",!0):$(".pub_list .body input.input_item").prop("checked",!1)},b=function(){$.ajax({type:"post",dataType:"json",url:"/pss/getZoneTeacherList",data:{code:$("#zone_code").val(),zoneid:$("#zone_zoneid").val()},success:function(t){if(0!=t.errcode)return void $.dialogFull.Tips(t.errmsg);var e="";t.data.map(function(t){e+='<option value="'+t.tid+'">'+t.teacher_name+"</option>"}),$("[name=teacher_id]").html(e).val(u),$("[name=assistant_id]").html('<option value="">请选择</option>'+e).val(p)},error:function(){$.dialogFull.Tips("网络错误，请稍后重试！")}})},k={},x="i"+parseInt(1e6*Math.random()).toString(),w=0,T=x+w,D=void 0,S="false";l&&function(){$.ajax({type:"post",dataType:"json",url:"/pss/getClassInfo",data:{code:$("#zone_code").val(),zoneid:$("#zone_zoneid").val(),classid:l},success:function(t){if(0!=t.errcode)return void $.dialogFull.Tips(t.errmsg);k=t.data;var e=(0,n.default)(r.edit,k);if($(".pub_form ul").html(e),"true"==t.data.audit&&$("#set_audit").prop("checked",!0),u=k.teacher_id,p=k.assistant_id||"",b(),k.time_regular=k.time_regular&&JSON.parse(k.time_regular).length&&JSON.parse(k.time_regular)||[{type:"day",day:0,time:""}],console.log(k.time_regular),k.time_regular.map(function(t,e){$(".timeList").append(r._item),$(".timeList .item").eq(e).find("select").eq(0).val(t.type),"week"==t.type?$(".timeList .item").eq(e).find("select").eq(1).val(t.day).show():"month"==t.type&&$(".timeList .item").eq(e).find("select").eq(2).val(t.day).show(),T=x+w,$(".timeList .item").eq(e).find("input").val(t.time).attr("id",x+w++),$.laydate.render({elem:"#"+T,type:"time",min:"08:00:00",max:"22:00:00",btns:["confirm"]}),0===e&&($(".timeList .item").eq(0).find("a").remove(),$(".timeList .item").eq(0).append('<a href="JavaScript:;" class="run_item_add">+</a>'))}),"true"==k.isStarted)$("#start_time").attr("disabled","disabled").addClass("disabled");else var o=$.laydate.render({elem:"#start_time",type:"date",value:k.start_time,min:1,ready:function(){o.hint("开班时间必须大于当前日期")}});D=t.data.remain_lessons||10,$(".tips").html("*当前剩余"+D+"个课时")},error:function(){$.dialogFull.Tips("网络错误，请稍后重试！")}})}(),$(".timeList .item").length>=6&&$(".timeList .run_item_add").hide();var F=function(){};$.mainBox.on("click","#submit_addOrEdit",function(){var t=$.form.get({error_text:"placeholder"});if(t){t.teacher_id=+t.teacher_id,t.assistant_id?t.assistant_id=+t.assistant_id:delete t.assistant_id,t.reserve_num=+t.reserve_num,t.audit=$("#set_audit:checked").val()?"true":"false",console.log(t),console.log(k);for(var e in t)t[e]==k[e]&&delete t[e];t.time_regular=[];var o=!0;if($(".timeList .item").each(function(){var e=$(this).find("input").eq(0).val();if(0==e.indexOf("00:00"))return void(o=!1);var i={};e&&(i.type=$(this).find("select").eq(0).val(),i.day=+$(this).find("select:visible").eq(-1).val()||0,i.time=e,t.time_regular.push(i))}),!o)return void $.dialogFull.Tips("请选择合理上课时间段！");if(m["course_"+v]&&m["course_"+v].length&&(t.selected_lessons=m["course_"+v],t.course_id=v),t.delete_old=S,!t.time_regular.length)return void $.dialogFull.Tips("请添加上课时段！");if(console.log(t.time_regular),console.log(JSON.stringify(t.time_regular)),console.log(k.time_regular),JSON.stringify(t.time_regular)==JSON.stringify(k.time_regular)&&delete t.time_regular,"{}"==JSON.stringify(t))return void $.dialogFull.Tips("您没有做任何修改！");var i={code:$("#zone_code").val(),zoneid:$("#zone_zoneid").val(),classid:l,data:JSON.stringify(t)};$.form.submit({url:"/pss/editClass",data:i,success:function(t){if(0!=t.errcode)return void $.dialogFull.Tips(t.errmsg);$.dialogFull.Tips("提交成功！"),$.ajaxGetHtml({url:t.data.url})},error:function(){$.dialogFull.Tips("网络错误，请稍后重试")}})}}).on("change",".timeType",function(){var t=$(this).val();"week"==t?($(this).siblings(".week").show(),$(this).siblings(".month").hide()):"month"==t?($(this).siblings(".month").show(),$(this).siblings(".week").hide()):$(this).siblings(".week, .month").hide()}).on("click",".run_item_add",function(){var t=$(r._item);T=x+w,t.find("input").eq(0).attr("id",x+w++),$(".timeList").append(t),$.laydate.render({elem:"#"+T,type:"time",min:"08:00:00",max:"22:00:00",btns:["confirm"]}),$(".timeList .item").length>=6&&$(this).hide()}).on("click",".run_item_del",function(){$(this).parent().remove(),$(".timeList .run_item_add").show()}).on("click",".btn_editClass",function(){$.dialogFull.Pop({boxClass:".pub_list",width:700,height:"auto",title:"重新关联课程",content:g(),showCallback:function(t,e){},runDone:function(t,e,o){o()}})}).on("click",".selected_lessons",function(){$.dialogFull.Pop({boxClass:".pub_list",width:700,height:"auto",cacheId:"popCachId002",title:"挑选课时",content:_,showCallback:function(t,e){m["course_"+v]&&m["course_"+v].length?(m["course_"+v].forEach(function(t,e){$("[value="+t.lesson_id+"]").attr("checked","true")}),m["course_"+v].length===$(".pub_list .body input.input_item").length?$("#checkall").prop("checked",!0):$("#checkall").prop("checked",!1)):$("#checkall").prop("checked",!1),$('[name="course_id"]').length&&$(".pub_list ul").DDSort({target:"li",up:function(){}})},runDone:function(t,e,o){var i=[],a=[];$(".pub_list .body input:checkbox:checked").each(function(){i.push($(this).val())}),i.forEach(function(t,e){a.push({lesson_id:t})}),m["course_"+v]=a,S=$('[name="delete_old"]:checked').val(),"true"===S?$(".selected_lessons").text("挑选课时("+a.length+")"):$(".selected_lessons").text("挑选课时("+(a.length+D)+")"),F=o,o()},runClose:function(t,e,o){F=o}})}),$(document).on("change","#checkall",y).on("change","input.input_item",function(){$(".pub_list .body input.input_item:checked").length===$(".pub_list .body input.input_item").length?$("#checkall").prop("checked",!0):$("#checkall").prop("checked",!1)}).on("change","[name=course_id]",function(){f($(this).val(),"","change")}),$.distory=function(){$(document).off("change","#checkall").off("change","input.input_item"),F(1)}},267:function(t,e){},7:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t,e){return t.replace(/\{([^\{|^\}]+)\}/gi,function(t,o){if(t&&o)return e[o]||0===e[o]?e[o]:""})};e.default=i}});